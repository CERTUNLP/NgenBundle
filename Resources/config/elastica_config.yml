# This file is part of the Ngen - CSIRT Incident Report System.
#
# (c) CERT UNLP <support@cert.unlp.edu.ar>
#
# This source file is subject to the GPL v3.0 license that is bundled
# with this source code in the file LICENSE.

fos_elastica:
    clients:
        default: { host: %elastic_host%, port: %elastic_port%, retryOnConflict: 10 }
    indexes:
        incidents:
            index_name: incidents_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
                    analysis:
                        analyzer:
                            email_analyser:
                                type: custom
                                tokenizer: uax_url_email
            types:
                incident:
                    properties:
                        id:
                            type: integer
                        date:
                            type: keyword
                            fields:
                                date:
                                    type: date
                        createdAt:
                            type: date
                        updatedAt:
                            type: keyword
                            fields:
                                date:
                                    type: date
                        isClosed:
                            type: boolean
                        isNew:
                            type: boolean
                        openedAt:
                            type: date
                        evidence_file_path:
                            type: keyword
                        ltdCount:
                            type: integer
                        origin:
                            type: "object"
                            properties:
                                address:
                                    type: keyword
                                ip:
                                    type: keyword
                                    fields:
                                        ip:
                                          type:  ip
                                domain:
                                    type: keyword
                        network:
                            type: "object"
                            properties:
                                ip:
                                    type: ip
                                ip_mask:
                                    type: integer
                                domain:
                                    type: keyword
                                isActive:
                                    type: boolean
                                networkAdmin:
                                    type: "object"
                                    properties:
                                        slug:
                                            type: keyword
                                        name:
                                            type: keyword
                                        isActive:
                                            type: boolean
                                networkEntity:
                                    type: "object"
                                    properties:
                                        slug:
                                            type: keyword
                                        name:
                                            type: keyword
                        tlp:
                            type: "object"
                            properties:
                                name:
                                    type: keyword
                                slug:
                                    type: keyword
                        state:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                        feed:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                        type:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                        assigned:
                            type: "object"
                            properties:
                                id:
                                    type: keyword
                                    null_value: "NULL"
                                username:
                                    type: keyword

                        reporter:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                firstname:
                                    type: keyword
                                lastname:
                                    type: keyword
                                email:
                                    type: string
                                    analyzer: email_analyser
                                username:
                                    type: keyword
                                enabled:
                                    type: boolean
                                createdAt:
                                    type: date
                                updatedAt:
                                    type: date
                        priority:
                            type: "object"
                            properties:
                                urgency:
                                    type: keyword
                                impact:
                                    type: keyword
                                name:
                                    type: keyword
                    persistence:
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\Incident
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        changeStateHistory:
            index_name: changestatehistory_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                incidentStateAction:
                    properties:
                        responsable:
                            type: keyword
                        date:
                            type: keyword
                        oldstate:
                            type: keyword
                        newstate:
                            type: keyword
                        actionApplied:
                            type: keyword
                    persistence:
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\IncidentChangeState
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        networks:
            index_name: networks_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
                    analysis:
                        analyzer:
                            email_analyser:
                                type: custom
                                tokenizer: uax_url_email
            types:
                network:
                    properties:
                        id:
                            type: integer
                        ip:
                            type: ip
                        type:
                            type: keyword
                        address:
                            type: keyword
                        addressAndMask:
                            type: keyword
                            index: not_analyzed
                        ip_mask:
                            type: integer
                        domain:
                            type: keyword
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                        isActive:
                            type: boolean
                        networkAdmin:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                                isActive:
                                    type: boolean
                                contacts:
                                    type: "nested"
                                    properties:
                                        email:
                                            type: string
                                            analyzer: email_analyser
                                        telegram:
                                            type: string
                        networkEntity:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                    persistence:
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Network\Network
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        hosts:
            index_name: hosts_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                host:
                    properties:
                        id:
                            type: integer
                        createdAt:
                            type: date
                        network:
                            type: "object"
                            properties:
                                ip:
                                    type: keyword
                                    fields:
                                        ip:
                                            type:  ip
                                domain:
                                    type: keyword
                        updatedAt:
                            type: date
                        ip:
                            type: ip
                        address:
                            type: keyword
                        isActive:
                            type: boolean
                    persistence:
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Network\Host\Host
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        network_admins:
            index_name: network_admins_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
                    analysis:
                        analyzer:
                            email_analyser:
                                type: custom
                                tokenizer: uax_url_email
            types:
                network_admin:
                    properties:
                        id:
                            type: integer
                        name:
                            type: keyword
                        slug:
                            type: keyword
                        isActive:
                            type: boolean
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                        contacts:
                            type: "nested"
                            properties:
                                email:
                                    type: string
                                    analyzer: email_analyser
                                telegram:
                                    type: string
                    persistence:
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Network\NetworkAdmin
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        network_entities:
            index_name: network_entitys_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                network_entity:
                    properties:
                        id:
                            type: integer
                        name:
                            type: keyword
                        slug:
                            type: keyword
                        isActive:
                            type: boolean
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                    persistence:
                        # the driver can be orm, mongodb or propel
                        # listener and finder: ~
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Network\NetworkEntity
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        feeds:
            index_name: feeds_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                feed:
                    properties:
                        name:
                            type: keyword
                        slug:
                            type: keyword
                        isActive:
                            type: boolean
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                    persistence:
                        identifier: slug
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\IncidentFeed
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        states:
            index_name: states_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                state:
                    properties:
                        name:
                            type: keyword
                        slug:
                            type: keyword
                        isActive:
                            type: boolean
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                        mailAdmin:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                        mailTeam:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                        mailReporter:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                        mailAssigned:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword


                    persistence:
                        identifier: slug
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\IncidentState
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        priorities:
            index_name: priorities_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                priority:
                    properties:
                        name:
                            type: keyword
                        slug:
                            type: keyword
                        response_time:
                            type: keyword
                        resolution_time:
                            type: keyword
                        code:
                            type: integer
                        impact:
                            type: keyword
                        urgency:
                            type: keyword
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                        isActive:
                            type: boolean
                    persistence:
                        identifier: slug
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\IncidentPriority
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        decisions:
            index_name: decisions_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                decision:
                    properties:
                        id:
                            type: integer
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                        isActive:
                            type: boolean
                        impact:
                            type: keyword
                        urgency:
                            type: keyword
                        state:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                        feed:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                        type:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                name:
                                    type: keyword
                        tlp:
                            type: "object"
                            properties:
                                name:
                                    type: keyword
                                slug:
                                    type: keyword
                        network:
                            type: "object"
                            properties:
                                ip:
                                    type: ip
                    persistence:
                        identifier: id
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\IncidentDecision
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        types:
            index_name: types_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                type:
                    properties:
                        name:
                            type: keyword
                        slug:
                            type: keyword
                        isActive:
                            type: boolean
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                        reports:
                            type: "object"
                            properties:
                                slug:
                                    type: keyword
                                lang:
                                    type: keyword
                    persistence:
                        identifier: slug
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\IncidentType
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        reports:
            index_name: reports_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
            types:
                report:
                    properties:
                        lang:
                            type: keyword
                        slug:
                            type: keyword
                        type:
                            type: keyword
                        problem:
                            type: text
                        derivated_problem:
                            type: text
                        verification:
                            type: text
                        more_information:
                            type: text
                        isActive:
                            type: boolean
                        createdAt:
                            type: date
                        updatedAt:
                            type: date
                    persistence:
                        identifier: slug
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\Incident\IncidentReport
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
        users:
            index_name: users_%kernel.environment%
            settings:
                index:
                    max_result_window: 50000
                    analysis:
                        analyzer:
                            email_analyser:
                                type: custom
                                tokenizer: uax_url_email
            types:
                user:
                    properties:
                        username:
                            type: keyword
                        firstname:
                            type: keyword
                        lastname:
                            type: keyword
                        slug:
                            type: keyword
                        email:
                            type: string
                            analyzer: email_analyser
                        isEnabled:
                            type: boolean
                        createdAt:
                            type: date
                    persistence:
                        identifier: slug
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver: orm
                        model: CertUnlp\NgenBundle\Entity\User
                        provider: ~
                        finder: ~
                        listener:
                            insert: true
                            update: true
                            delete: true
