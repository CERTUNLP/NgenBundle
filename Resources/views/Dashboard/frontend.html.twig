{# 
 This file is part of the Ngen - CSIRT Incident Report System.
 
 (c) CERT UNLP <support@cert.unlp.edu.ar>
 
 This source file is subject to the GPL v3.0 license that is bundled
 with this source code in the file LICENSE.
#}
{% extends 'CertUnlpNgenBundle::frontend.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block content_header %}
    <h1 class="h3 mb-0 text-gray-800">{{ icon('fas fa-laptop') }} {{ 'Dashboards'|trans }}</h1>
{% endblock %}

{% block sideBar_search_path %}{% endblock %}

{% block content_body %}
    <div id="internaliframe" class="embed-container">
        <iframe src="" frameborder="0" scrolling="no" id="internaldashboard"></iframe>
    </div>

    <div class="embed-container" >
        <iframe id="externaldashboard" width="100%" frameborder="0" allowfullscreen>
        </iframe>
    </div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        $.ajaxSetup({
                username: 'user',
                password: '{{ app.user.apiKey }}',
                xhrFields: { withCredentials: true }
        });
        $.ajax(
            {
                xhrFields: { withCredentials: true },
                type: 'GET',
                url: "/grafana/{{ internalDashboard }}",
                username: 'user',
                password: '{{ app.user.apiKey }}',
                contentType: 'application/json',
                success: function(data){
                    var iframeDoc = $("#internaldashboard").get(0).contentDocument;
                    iframeDoc.open();
                    iframeDoc.write(data);
                    iframeDoc.close();
                    $('#internaliframe').html('<iframe src="/grafana/{{ internalDashboard }}" frameborder="0" scrolling="no" id="internaldashboard"></iframe>');        
                }
            }
        );

    </script>
{% endblock %}

