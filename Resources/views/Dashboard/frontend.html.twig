{# 
 This file is part of the Ngen - CSIRT Incident Report System.
 
 (c) CERT UNLP <support@cert.unlp.edu.ar>
 
 This source file is subject to the GPL v3.0 license that is bundled
 with this source code in the file LICENSE.
#}
{% extends 'CertUnlpNgenBundle::frontend.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block content_header %}
    <h1 class="h3 mb-0 text-gray-800">{{ icon('fas fa-laptop') }} {{ 'Dashboards'|trans }}</h1>
{% endblock %}

{% block sideBar_search_path %}{% endblock %}

{% block content_body %}
    <div class="embed-container">
        <iframe id="internal-dashboard" width="100%" frameborder="0" allowfullscreen>
        </iframe>
    </div>

    <div class="embed-container" >
        <iframe id="external-dashboard" width="100%" frameborder="0" allowfullscreen>
        </iframe>
    </div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        $.ajax(
            {
                type: 'GET',
                url: "/secure/{{ internalDashboard }}",
                contentType: 'application/json',
                beforeSend: function(xhr, settings) {
                    xhr.setRequestHeader(
                        'Authorization', 'Basic ' + window.btoa("auth" + ":" + "{{ app.user.apiKey }}")
                    );
                },
                success: function(data) {
                    $('#internal-dashboard').attr('src', "/secure/{{ internalDashboard }}");
                    $('#internal-dashboard').contents().find('html').html(data);
                }
            }
        );
    </script>
{% endblock %}
