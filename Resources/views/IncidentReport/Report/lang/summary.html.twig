{#
 This file is part of the Ngen - CSIRT Incident Report System.

 (c) CERT UNLP <support@cert.unlp.edu.ar>

 This source file is subject to the GPL v3.0 license that is bundled
 with this source code in the file LICENSE.
#}

<div class="tab-pane fade" id="state_changes" role="tabpanel" aria-labelledby="state_changes-tab">

    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="d-flex card-header align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">{{ 'Historical State Changes'|trans }} </h6>
                    <h6 class="m-0 font-weight-normal text-primary">
                        <b>{{ object.getChangeStateHistory.count }}</b> {{ 'state changes'|trans }}</h6>
                </div>
                <div class="card-body overflow-auto" style="max-height: 50vh">
                    {% include "CertUnlpNgenBundle:Incident:Frontend/historyChangeSummary.html.twig" with {'incident': object} %}
                </div>
            </div>
        </div>
    </div>
</div>


{% set titulos=0 %}
{% block incidents_detected %}
    {% for detected in incident.incidentsDetected %}
        {% if(detected.notes) %}
            {% if titulos == 0 %}
                {% set titulos=1 %}
                <tr>
                <td>
                <p>
                    {% block incident_notes_title %}
                    {% endblock %}
                </p>
                <ul>
            {% endif %}

            {{ detected.notes| striptags('<div>,<a>,<pre>,<code>,<li>,<ul>,<br>')|raw|nl2br }}

        {% endif %}
    {% endfor %}
    {% if titulos == 1 %}
        </ul>
        </td>
        </tr>
    {% endif %}
{% endblock %}


<div class="card-body overflow-auto" style="max-height: 70vh">
    {% block comments_body %}
        {{ render(controller('CertUnlpNgenBundle:Frontend/Incident/IncidentFrontend:incidentComments', {'incident': incident, 'request': app.request})) }}
    {% endblock %}
</div>

{% set titulos=0 %}
{% block historical_states_changes %}
    {% for change in incident.incidentsDetected %}
        {% if(detected.notes) %}
            {% if titulos == 0 %}
                {% set titulos=1 %}
                <tr>
                <td>
                <p>

                </p>
                <ul>
            {% endif %}

            {{ detected.notes| striptags('<div>,<a>,<pre>,<code>,<li>,<ul>,<br>')|raw|nl2br }}

        {% endif %}
    {% endfor %}
    {% if titulos == 1 %}
        </ul>
        </td>
        </tr>
    {% endif %}
{% endblock %}


<div class="tab-pane fade" id="detections" role="tabpanel" aria-labelledby="detections-tab">

    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="d-flex card-header align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">{{ "Historical Detections"|trans }}</h6>
                    <h6 class="m-0 font-weight-normal text-primary">
                        <b>{{ object.incidentsDetected.count }} </b>{{ 'detections'|trans }}
                    </h6>
                </div>
                <div class="card-body overflow-auto" style="max-height: 50vh">
                    {% include "@CertUnlpNgen/Incident/Frontend/redetectedTable.html.twig" with {'incident': object,'incidentsDetected':object.incidentsDetected} %}
                </div>
            </div>
        </div>
    </div>
</div>
<div class="tab-pane fade" id="state_changes" role="tabpanel" aria-labelledby="state_changes-tab">

    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="d-flex card-header align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">{{ 'Historical State Changes'|trans }} </h6>
                    <h6 class="m-0 font-weight-normal text-primary">
                        <b>{{ object.getChangeStateHistory.count }}</b> {{ 'state changes'|trans }}</h6>
                </div>
                <div class="card-body overflow-auto" style="max-height: 50vh">
                    {% include "CertUnlpNgenBundle:Incident:Frontend/historyChangeSummary.html.twig" with {'incident': object} %}
                </div>
            </div>
        </div>
    </div>
</div>
<div class="tab-pane fade" id="comments" role="tabpanel" aria-labelledby="comments-tab">
    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h6 class="m-0 font-weight-bold text-primary">
                        {{ 'Comments'|trans }}
                    </h6>

                </div>
                <div class="card-body overflow-auto" style="max-height: 70vh">
                    {% block comments_body2 %}
                        {{ render(controller('CertUnlpNgenBundle:Frontend/Incident/IncidentFrontend:incidentComments', {'incident': object, 'request': app.request})) }}
                    {% endblock %}
                </div>
            </div>
        </div>
    </div>
</div>