{# 
 This file is part of the Ngen - CSIRT Incident Report System.
 
 (c) CERT UNLP <support@cert.unlp.edu.ar>
 
 This source file is subject to the GPL v3.0 license that is bundled
 with this source code in the file LICENSE.
#}
{% extends 'CertUnlpNgenBundle::Incident/Frontend/frontend.html.twig' %}

{% block content_body %}
    <div class="panel panel-default">
        <div class="panel-heading">
            {% block list_header %}
               <strong>{{ icon('arrow-circle-down fa-fw') }} {{ "Incidents" | trans }} </strong>
            {% endblock %}
            <strong>({{ objects.getPaginationData.lastItemNumber~"/"~objects.getTotalItemCount }})</strong>
            <div class="pull-right">
                <div class="btn-group">
                    {% block add_incident %}
                        <a class="btn btn-default btn-xs"
                           href="{{ path('cert_unlp_ngen_internal_incident_frontend_new_incident') }}">
                            {{ icon('plus-circle fa-fw') }}add incident
                        </a>
                    {% endblock %}

                </div>
            </div>
        </div>
        <table class="table table-striped table-bordered table-hover dataTable no-footer">
            <tr role="row">
                <th>{{ knp_pagination_sortable(objects, 'Status'| trans, 'state.name')  }}</th>
                <th>{{ knp_pagination_sortable(objects, 'Address'| trans , 'origin.ip')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Assigned'| trans , 'assigned.username')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Type'| trans, 'type.name')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Feed'| trans, 'feed.name')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Date'| trans, 'date')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Priority'| trans, 'priority')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Response Time/Resolution Time'| trans, 'updatedAt')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'LTD'| trans, 'tld.slug') }}</th>
                <th>{{ knp_pagination_sortable(objects, 'TLP'| trans, 'tlp.slug')}}</th>
                <th>Action</th>
            </tr>
            <tbody>
            {% for incident in objects %}
                {% block listmine_body %}
                    {% include 'CertUnlpNgenBundle:Incident:Frontend/list/incidentListRow.html.twig' with {'incident': incident} %}
                {% endblock %}

            {% endfor %}
            </tbody>

        </table>
    </div>
    <div class="pagination-centered">
        {{ knp_pagination_render(objects, null, {}, { "prev_label": "Previous", "next_label": "Next", "first_label": "First", "last_label": "Last"}) }}
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
                <strong>{{ icon('arrow-circle-down fa-fw') }} {{ "My Incidents" | trans }} </strong>
            <strong>({{ my_objects.getPaginationData.lastItemNumber~"/"~my_objects.getTotalItemCount }})</strong>
            <div class="pull-right">
                <div class="btn-group">

                </div>
            </div>
        </div>
        <table class="table table-striped table-bordered table-hover dataTable no-footer">
            <tr role="row">
                <th>{{ knp_pagination_sortable(objects, 'Status'| trans, 'state.name')  }}</th>
                <th>{{ knp_pagination_sortable(objects, 'Address'| trans , 'origin.ip')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Assigned'| trans , 'assigned.username')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Type'| trans, 'type.name')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Feed'| trans, 'feed.name')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Date'| trans, 'date')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Priority'| trans, 'priority')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'Response Time/Resolution Time'| trans, 'updatedAt')}}</th>
                <th>{{ knp_pagination_sortable(objects, 'LTD'| trans, 'tld.slug') }}</th>
                <th>{{ knp_pagination_sortable(objects, 'TLP'| trans, 'tlp.slug')}}</th>
                <th>Action</th>
            </tr>
            <tbody>
            {% for incident in my_objects %}
                {% block list_body %}
                    {% include 'CertUnlpNgenBundle:Incident:Frontend/list/incidentListRow.html.twig' with {'incident': incident} %}
                {% endblock %}

            {% endfor %}
            </tbody>

        </table>
    </div>
    <div class="pagination-centered">
        {{ knp_pagination_render(my_objects, null, {}, { "prev_label": "Previous", "next_label": "Next", "first_label": "First", "last_label": "Last"}) }}
    </div>

    <div class="panel panel-default">
    <div class="panel-heading">
        <strong>{{ icon('arrow-circle-down fa-fw') }} {{ "Unassigned Incidents" | trans }} </strong>
        <strong>({{ unassigned_objects.getPaginationData.lastItemNumber~"/"~unassigned_objects.getTotalItemCount }})</strong>
        <div class="pull-right">
            <div class="btn-group">

            </div>
        </div>
    </div>
    <table class="table table-striped table-bordered table-hover dataTable no-footer">
        <tr role="row">
            <th>{{ knp_pagination_sortable(objects, 'Status'| trans, 'state.name')  }}</th>
            <th>{{ knp_pagination_sortable(objects, 'Address'| trans , 'origin.ip')}}</th>
            <th>{{ knp_pagination_sortable(objects, 'Assigned'| trans , 'assigned.username')}}</th>
            <th>{{ knp_pagination_sortable(objects, 'Type'| trans, 'type.name')}}</th>
            <th>{{ knp_pagination_sortable(objects, 'Feed'| trans, 'feed.name')}}</th>
            <th>{{ knp_pagination_sortable(objects, 'Date'| trans, 'date')}}</th>
            <th>{{ knp_pagination_sortable(objects, 'Priority'| trans, 'priority')}}</th>
            <th>{{ knp_pagination_sortable(objects, 'Response Time/Resolution Time'| trans, 'updatedAt')}}</th>
            <th>{{ knp_pagination_sortable(objects, 'LTD'| trans, 'tld.slug') }}</th>
            <th>{{ knp_pagination_sortable(objects, 'TLP'| trans, 'tlp.slug')}}</th>
            <th>Action</th>
        </tr>
        <tbody>
        {% for incident in unassigned_objects %}
            {% block list_unasigned_body %}
                {% include 'CertUnlpNgenBundle:Incident:Frontend/list/incidentListRow.html.twig' with {'incident': incident} %}
            {% endblock %}

        {% endfor %}
        </tbody>

    </table>
    </div>
    <div class="pagination-centered">
        {{ knp_pagination_render(unassigned_objects, null, {}, { "prev_label": "Previous", "next_label": "Next", "first_label": "First", "last_label": "Last"}) }}
    </div>
{% endblock %}

{% block sideBar_search_path %}{{ path('cert_unlp_ngen_internal_incident_search_incident') }}{% endblock %}

{% block content_header %}
    <h1 class="page-header">{{ icon('arrow-circle-down fa-fw') }} {{ "Incidents" | trans }}</h1>

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
        '@CertUnlpNgenBundle/Resources/public/js/incident/InternalIncident.js'
        '@CertUnlpNgenBundle/Resources/public/js/incident/InternalIncidentApi.js' %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script>
        var internalIncidentApi = new InternalIncidentApi("{{ path("api_get") }}", "{{ app.user.apiKey }}");
        var internalIncident = new InternalIncident();
    </script>
{% endblock %}